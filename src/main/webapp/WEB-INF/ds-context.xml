<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
        "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="true">

    <bean id="pds" class="com.mchange.v2.c3p0.ComboPooledDataSource">
        <property name="driverClass" value="org.postgresql.Driver"/>
        <property name="jdbcUrl" value="jdbc:postgresql://localhost/traffic"/>
        <property name="user" value="root"/>
        <property name="password" value="test12~"/>
    </bean>

    <bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
        <property name="annotatedClasses">
            <list>
                <value>net.paguo.domain.clients.AbstractItem</value>
                <value>net.paguo.domain.clients.ClientItem</value>
                <value>net.paguo.domain.clients.EquipmentItem</value>
                <value>net.paguo.domain.clients.PostalAddress</value>
                <value>net.paguo.domain.common.ContactData</value>
                <value>net.paguo.domain.common.PersonalData</value>
                <value>net.paguo.domain.events.ScheduleEvent</value>
                <value>net.paguo.domain.problems.ClientComplaint</value>
                <value>net.paguo.domain.problems.FailureRestore</value>
                <value>net.paguo.domain.problems.NetworkFailure</value>
                <value>net.paguo.domain.problems.NetworkProblem</value>
                <value>net.paguo.domain.requests.ChangeStatusRequest</value>
                <value>net.paguo.domain.requests.RequestInformation</value>
                <value>net.paguo.domain.requests.Notice</value>
                <value>net.paguo.domain.requests.EmailNotice</value>
                <value>net.paguo.domain.requests.PhoneNotice</value>
                <value>net.paguo.domain.users.AbstractRole</value>
                <value>net.paguo.domain.users.ApplicationRole</value>
                <value>net.paguo.domain.users.LocalRole</value>
                <value>net.paguo.domain.users.LocalGroup</value>
                <value>net.paguo.domain.users.LocalUser</value>
                <value>net.paguo.domain.users.UserPermission</value>
                <value>net.paguo.domain.application.ApplicationSettings</value>
                <value>net.paguo.domain.equipment.ClientEndpoint</value>
                <value>net.paguo.domain.auxilliary.StreetDictionary</value>
                <value>net.paguo.domain.testing.Request</value>
                <value>net.paguo.domain.testing.RequiredService</value>
                <value>net.paguo.domain.testing.ClientInformation</value>
                <value>net.paguo.domain.testing.ClientContactInformation</value>
                <value>net.paguo.domain.testing.BuildingInformation</value>
                <value>net.paguo.domain.testing.AddressInformation</value>
                <value>net.paguo.domain.testing.Testing</value>
                <value>net.paguo.domain.testing.TestingPlan</value>
                <value>net.paguo.domain.testing.TestingResults</value>
            </list>
        </property>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
                <prop key="hibernate.cache.provider_class">org.hibernate.cache.EhCacheProvider</prop>
                <prop key="hibernate.show_sql">false</prop>
                <prop key="hibernate.hbm2ddl.auto">update</prop>
                <prop key="hibernate.cache.use_query_cache">true</prop>
                <prop key="hibernate.search.default.directory_provider">org.hibernate.search.store.FSDirectoryProvider
                </prop>
                <prop key="hibernate.search.default.indexBase">/var/lucene</prop>
            </props>
        </property>
        <property name="dataSource" ref="pds"/>
        <property name="eventListeners">
            <map>
                <entry key="post-update">
                    <list>
                        <ref local="fullTextIndexEventListener"/>
                        <ref local="eventNotificationListener"/>
                    </list>
                </entry>
                <entry key="post-insert">
                    <list>
                        <ref local="fullTextIndexEventListener"/>
                        <ref local="eventNotificationListener"/>
                    </list>
                </entry>
                <entry key="post-delete">
                    <ref local="fullTextIndexEventListener"/>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="fullTextIndexEventListener" class="org.hibernate.search.event.FullTextIndexEventListener"/>
    <bean id="eventNotificationListener" class="net.paguo.listeners.EventNotificationListener">
        <property name="registry">
            <map>
                <entry key="net.paguo.domain.testing.Request">
                    <bean id="testtingRequestNotifierImpl" class="net.paguo.messaging.impl.TestingRequestNotifierImpl">
                        <property name="controller" ref="subscriptionsController"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="complaintSearchController" class="net.paguo.search.controller.ComplaintSearchController">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="problemSearchController"
          class="net.paguo.search.controller.NetworkProblemSearchController">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="finderIntroductionAdvisor" class="net.paguo.generic.dao.finder.impl.FinderIntroductionAdvisor"/>

    <bean id="abstractDaoTarget" class="net.paguo.generic.dao.impl.GenericDaoHibernateImpl" abstract="true">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="abstractDao"
          class="org.springframework.aop.framework.ProxyFactoryBean" abstract="true">
        <property name="interceptorNames">
            <list>
                <value>finderIntroductionAdvisor</value>
            </list>
        </property>
    </bean>

    <bean id="clientItemDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ClientItemDAO"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.clients.ClientItem"/>
            </bean>
        </property>
    </bean>

    <bean id="networkFailureDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.NetworkFailureDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.problems.NetworkFailure"/>
            </bean>
        </property>
    </bean>

    <bean id="streetsDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.StreetsDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.auxilliary.StreetDictionary"/>
            </bean>
        </property>
    </bean>

    <bean id="clientComplaintDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ClientComplaintDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.problems.ClientComplaint"/>
            </bean>
        </property>
    </bean>

    <!--<bean id="problemDao" parent="abstractDaoTarget" class="net.paguo.dao.impl.NetworkProblemDaoImpl"/>-->
    <bean id="problemDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.NetworkProblemDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.problems.NetworkProblem"/>
            </bean>
        </property>
    </bean>

    <bean id="groupDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.LocalGroupDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.users.LocalGroup"/>
            </bean>
        </property>
    </bean>

    <bean id="permissionDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.UserPermissionDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.users.UserPermission"/>
            </bean>
        </property>
    </bean>

    <bean id="userDao" parent="abstractDaoTarget" class="net.paguo.dao.impl.LocalUserDaoImpl"/>

    <bean id="roleDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.LocalRoleDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.users.LocalRole"/>
            </bean>
        </property>
    </bean>

    <bean id="changeStatusRequestDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ChangeStatusRequestDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.requests.ChangeStatusRequest"/>
            </bean>
        </property>
    </bean>

    <bean id="changeStatusRequestDaoNG" parent="abstractDaoTarget"
          class="net.paguo.dao.impl.ChangeStatusRequestDaoImpl"/>
    
    <bean id="requestDao" parent="abstractDaoTarget"
        class="net.paguo.dao.impl.RequestDaoImpl"/>

    <bean id="settingsDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ApplicationSettingsDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.application.ApplicationSettings"/>
            </bean>
        </property>
    </bean>

    <bean id="applicationRoleDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ApplicationRoleDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.users.ApplicationRole"/>
            </bean>
        </property>
    </bean>

    <bean id="endpointDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.ClientEndpointDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.equipment.ClientEndpoint"/>
            </bean>
        </property>
    </bean>

    <bean id="requestSubscriptionDao" parent="abstractDao">
        <property name="proxyInterfaces" value="net.paguo.dao.RequestSubscriptionDao"/>
        <property name="target">
            <bean parent="abstractDaoTarget">
                <constructor-arg value="net.paguo.domain.messaging.RequestSubscription"/>
            </bean>
        </property>
    </bean>

    <bean id="settingsController" class="net.paguo.controller.ApplicationSettingsController">
        <property name="dao" ref="settingsDao"/>
    </bean>

    <bean id="subscriptionsController" class="net.paguo.controller.RequestSubscriptionController">
        <property name="subscriptionDao" ref="requestSubscriptionDao"/>
    </bean>

    <bean id="failureController" class="net.paguo.controller.NetworkFailureController">
        <property name="failureDao" ref="networkFailureDao"/>
        <property name="complaintDao" ref="clientComplaintDao"/>
        <property name="problemDao" ref="problemDao"/>
    </bean>

    <bean id="clientController" class="net.paguo.controller.ClientItemController">
        <property name="clientDao" ref="clientItemDao"/>
    </bean>

    <bean id="usersController" class="net.paguo.controller.UsersController">
        <property name="rolesDao" ref="roleDao"/>
        <property name="usersDao" ref="userDao"/>
        <property name="groupDao" ref="groupDao"/>
        <property name="applicationRoleDao" ref="applicationRoleDao"/>
    </bean>

    <bean id="changeStatusRequestController" class="net.paguo.controller.ChangeStatusRequestController">
        <property name="requestDao" ref="changeStatusRequestDaoNG"/>
        <property name="endpointDao" ref="endpointDao"/>
    </bean>

    <bean id="requestController" class="net.paguo.controller.request.RequestController">
        <property name="requestDao" ref="requestDao"/>
    </bean>

    <bean id="streetsController" class="net.paguo.controller.auxilliary.StreetsController">
        <property name="streetsDao" ref="streetsDao"/>
    </bean>

    <bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>


    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource" ref="pds"/>
        <property name="lazyInit" value="true"/>
    </bean>

    <bean id="complaintsSearch" class="net.paguo.search.controller.GenericSearchController">
        <constructor-arg value="net.paguo.domain.problems.ClientComplaint"/>
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="problemsSearch" class="net.paguo.search.controller.GenericSearchController">
        <constructor-arg value="net.paguo.domain.problems.NetworkProblem"/>
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="requestReportExport" class="net.paguo.exports.RequestReportExport">
        <property name="controller" ref="changeStatusRequestController"/>
        <property name="messageSource" ref="messageSource"/>
        <property name="headers">
            <list>
                <value type="java.lang.String">excel.client.header</value>
                <value type="java.lang.String">excel.disconnection.type</value>
                <value type="java.lang.String">excel.recipe.header</value>
                <value type="java.lang.String">excel.address.header</value>
                <value type="java.lang.String">excel.creation.date.header</value>
                <value type="java.lang.String">excel.creation.author.header</value>
                <value type="java.lang.String">excel.execution.date.header</value>
                <value type="java.lang.String">excel.execution.author.header</value>
                <value type="java.lang.String">excel.execution.endpoint.header</value>
                <value type="java.lang.String">excel.recreation.date.header</value>
                <value type="java.lang.String">excel.recreation.author.header</value>
                <value type="java.lang.String">excel.reexec.date.header</value>
                <value type="java.lang.String">excel.reexec.author.header</value>
            </list>
        </property>
        <property name="properties">
            <list>
                <value type="java.lang.String">showClient</value>
                <value type="java.lang.String">numericalType</value>
                <value type="java.lang.String">description</value>
                <value type="java.lang.String">discAddress</value>
                <value type="java.lang.String">cancelRequest.dateEntered</value>
                <value type="java.lang.String">cancelRequest.author</value>
                <value type="java.lang.String">cancelExec.dateEntered</value>
                <value type="java.lang.String">cancelExec.author</value>
                <value type="java.lang.String">endpoint</value>
                <value type="java.lang.String">restoreRequest.dateEntered</value>
                <value type="java.lang.String">restoreRequest.author</value>
                <value type="java.lang.String">restoreExec.dateEntered</value>
                <value type="java.lang.String">restoreExec.author</value>
            </list>
        </property>
        <property name="formatters">
            <map>
                <entry key="numericalType" value="permanentChoice"/>
            </map>
        </property>
    </bean>

    <bean id="complaintsExporter" class="net.paguo.exports.ComplaintsExcelExporter">
        <property name="controller" ref="failureController"/>
        <property name="messageSource" ref="messageSource"/>
        <property name="headers">
            <list>
               <value type="java.lang.String">problem.id</value>
               <value type="java.lang.String">problem.time</value>
               <value type="java.lang.String">complaint.clientName</value>
               <value type="java.lang.String">problem.author</value>
               <value type="java.lang.String">complaint.description</value>
               <value type="java.lang.String">problem.cause</value>
               <value type="java.lang.String">problem.action</value>
               <value type="java.lang.String">problem.closeTime</value>
               <value type="java.lang.String">problem.closed</value> 
            </list>
        </property>
        <property name="properties">
            <list>
                <value type="java.lang.String">id</value>
                <value type="java.lang.String">failureTime</value>
                <value type="java.lang.String">reportedClient</value>
                <value type="java.lang.String">userCreated</value>
                <value type="java.lang.String">failureDescription</value>
                <value type="java.lang.String">restoreAction.failureCause</value> 
                <value type="java.lang.String">restoreAction.restoreAction</value>
                <value type="java.lang.String">restoreAction.restoreTime</value>
                <value type="java.lang.String">restoreAction.numericalClose</value> 
            </list>
        </property>
        <property name="formatters">
            <map>
                <entry key="restoreAction.numericalClose" value="completedChoice"/>
            </map>
        </property>
    </bean>

    <bean id="problemsExporter" class="net.paguo.exports.ProblemsExcelExporterImpl">
        <property name="controller" ref="failureController"/>
        <property name="messageSource" ref="messageSource"/>
        <property name="headers">
            <list>
               <value type="java.lang.String">problem.id</value>
               <value type="java.lang.String">problem.time</value>
               <value type="java.lang.String">problem.author</value>
               <value type="java.lang.String">complaint.description</value>
               <value type="java.lang.String">problem.cause</value>
               <value type="java.lang.String">problem.action</value>
               <value type="java.lang.String">problem.closeTime</value>
               <value type="java.lang.String">problem.closed</value>
            </list>
        </property>
        <property name="properties">
            <list>
                <value type="java.lang.String">id</value>
                <value type="java.lang.String">failureTime</value>
                <value type="java.lang.String">userCreated</value>
                <value type="java.lang.String">failureDescription</value>
                <value type="java.lang.String">restoreAction.failureCause</value>
                <value type="java.lang.String">restoreAction.restoreAction</value>
                <value type="java.lang.String">restoreAction.restoreTime</value>
                <value type="java.lang.String">restoreAction.numericalClose</value>
            </list>
        </property>
        <property name="formatters">
            <map>
                <entry key="restoreAction.numericalClose" value="completedChoice"/>
            </map>
        </property>
    </bean>

    <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basename" value="messages"/>
    </bean>

</beans>